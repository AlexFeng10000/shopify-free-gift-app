<!DOCTYPE html>
<html>
<head>
    <title>Force Reinstall Shopify App</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .step { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        button { padding: 12px 24px; margin: 10px 0; background: #007ace; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background: #005a87; }
        code { background: #f4f4f4; padding: 2px 4px; border-radius: 3px; }
        .url { background: #e3f2fd; padding: 10px; border-radius: 4px; font-family: monospace; word-break: break-all; }
    </style>
</head>
<body>
    <h1>üîÑ Force Reinstall Shopify App</h1>
    
    <div class="step warning">
        <h3>Current Issue</h3>
        <p>Your app is missing the <code>host</code> parameter, which means it's not properly embedded. This usually happens when:</p>
        <ul>
            <li>‚ùå App is not configured as "Embedded app" in Partner Dashboard</li>
            <li>‚ùå App was installed before proper configuration</li>
            <li>‚ùå App URLs don't match exactly</li>
        </ul>
    </div>

    <div class="step">
        <h3>Step 1: Uninstall Current App</h3>
        <p>Go to your development store admin and uninstall the current app:</p>
        <ol>
            <li>Go to: <code>https://gift-booster-test.myshopify.com/admin/apps</code></li>
            <li>Find your "Gift Booster" app</li>
            <li>Click the "..." menu ‚Üí "Uninstall"</li>
        </ol>
    </div>

    <div class="step">
        <h3>Step 2: Verify Partner Dashboard Settings</h3>
        <p>In your Shopify Partner Dashboard, make sure these are set EXACTLY:</p>
        <ul>
            <li><strong>App URL</strong>: <code>https://web-production-99c0.up.railway.app</code></li>
            <li><strong>Allowed redirection URLs</strong>: <code>https://web-production-99c0.up.railway.app/auth/callback</code></li>
            <li><strong>Embedded app</strong>: ‚úÖ ENABLED</li>
        </ul>
    </div>

    <div class="step">
        <h3>Step 3: Fresh Installation</h3>
        <p>Click this button to start a fresh installation with proper embedding:</p>
        <button onclick="forceReinstall()">üîÑ Force Fresh Installation</button>
        <br><br>
        <p>This will redirect you to Shopify OAuth with the correct parameters for embedded app installation.</p>
    </div>

    <div class="step success">
        <h3>Expected Result After Reinstall</h3>
        <p>After successful reinstall, when you access the app through Shopify admin, you should see:</p>
        <pre>
üîç URL Parameters:
  shop: gift-booster-test.myshopify.com
  host: Z2lmdC1ib29zdGVyLXRlc3QubXlzaG9waWZ5LmNvbS9hZG1pbg  ‚Üê This should appear!
  demo: null
  installed: true
üîó App Bridge available, getting session token...
‚úÖ Session token obtained
        </pre>
    </div>

    <script>
        function forceReinstall() {
            // Force a fresh OAuth installation
            const shop = 'gift-booster-test.myshopify.com';
            const clientId = '0a84e1df4c003abfab2f61d8344ea04b';
            const appUrl = 'https://web-production-99c0.up.railway.app';
            const redirectUri = `${appUrl}/auth/callback`;
            const scopes = 'read_products,write_products,read_orders,write_draft_orders';
            const state = Math.random().toString(36).substring(7);
            
            const oauthUrl = `https://${shop.replace('.myshopify.com', '')}.myshopify.com/admin/oauth/authorize?` +
                `client_id=${clientId}&` +
                `scope=${encodeURIComponent(scopes)}&` +
                `redirect_uri=${encodeURIComponent(redirectUri)}&` +
                `state=${state}`;
            
            console.log('üîÑ Starting fresh OAuth installation:', oauthUrl);
            window.location.href = oauthUrl;
        }
    </script>
</body>
</html>